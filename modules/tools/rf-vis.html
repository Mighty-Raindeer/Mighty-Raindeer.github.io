<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RF Generation Methods | Medical Physics Study Guide</title>

    <style>
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #242424;
            --bg-card: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent-primary: #ff5722;
            --accent-hover: #f4511e;
            --border-color: rgba(255, 255, 255, 0.1);
            --electron-blue: #3b82f6;
            --field-red: #ef4444;
            --field-green: #10b981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 20px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Montserrat', sans-serif;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: var(--accent-primary);
            text-align: center;
            margin-bottom: 30px;
        }

        .devices-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .device-card {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .device-card h2 {
            color: var(--accent-primary);
            margin-bottom: 15px;
            text-align: center;
        }

        .canvas-container {
            width: 100%;
            height: 450px;
            background: var(--bg-card);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            padding: 8px 16px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.9rem;
        }

        button:hover {
            background: var(--accent-hover);
        }

        .info-section {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: var(--accent-primary);
            margin-bottom: 10px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .comparison-item {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 4px;
        }

        .comparison-item h4 {
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .comparison-item ul {
            margin-left: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .comparison-item li {
            margin-bottom: 5px;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
            padding: 10px;
            background: var(--bg-card);
            border-radius: 4px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        .legend-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        @media (max-width: 968px) {
            .devices-grid {
                grid-template-columns: 1fr;
            }
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>RF Generation Methods for Linear Accelerators</h1>

        <div class="devices-grid">
            <!-- Klystron -->
            <div class="device-card">
                <h2>Klystron (Amplifier)</h2>
                <div class="canvas-container">
                    <canvas id="klystron-canvas"></canvas>
                </div>
                <div class="controls">
                    <button onclick="klystronViz.toggle()">Play/Pause</button>
                    <button onclick="klystronViz.reset()">Reset</button>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--electron-blue); height: 6px; width: 6px; border-radius: 50%;"></div>
                        <span class="legend-label">Electrons</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--field-red);"></div>
                        <span class="legend-label">E-field oscillation</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--field-green);"></div>
                        <span class="legend-label">RF signal</span>
                    </div>
                </div>
            </div>

            <!-- Magnetron -->
            <div class="device-card">
                <h2>Magnetron (Oscillator)</h2>
                <div class="canvas-container">
                    <canvas id="magnetron-canvas"></canvas>
                </div>
                <div class="controls">
                    <button onclick="magnetronViz.toggle()">Play/Pause</button>
                    <button onclick="magnetronViz.reset()">Reset</button>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--electron-blue); height: 6px; width: 6px; border-radius: 50%;"></div>
                        <span class="legend-label">Electron cloud</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--field-red);"></div>
                        <span class="legend-label">E-field (radial)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #9333ea;"></div>
                        <span class="legend-label">B-field (⊙ into page)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h3>How RF Generation Works</h3>
            <div class="comparison-grid">
                <div class="comparison-item">
                    <h4>Klystron</h4>
                    <ul>
                        <li><strong>Type:</strong> RF Amplifier (requires input signal)</li>
                        <li><strong>Electron beam:</strong> Linear, velocity-modulated into bunches</li>
                        <li><strong>Buncher cavity:</strong> Input RF creates oscillating E-field, modulates electron velocity</li>
                        <li><strong>Drift space:</strong> Fast electrons catch slow ones → bunching</li>
                        <li><strong>Catcher cavity:</strong> Bunched electrons transfer energy → amplified RF output</li>
                        <li><strong>Gain:</strong> 30-60 dB amplification</li>
                        <li><strong>Clinical use:</strong> High-energy linacs (≥6 MV)</li>
                    </ul>
                </div>
                <div class="comparison-item">
                    <h4>Magnetron</h4>
                    <ul>
                        <li><strong>Type:</strong> RF Oscillator (self-generating)</li>
                        <li><strong>Electron motion:</strong> Circular/spiral paths (crossed E & B fields)</li>
                        <li><strong>E-field:</strong> Radial (cathode → anode)</li>
                        <li><strong>B-field:</strong> Axial (perpendicular to E-field)</li>
                        <li><strong>Cavity resonance:</strong> Electron "spokes" induce oscillations in cavities</li>
                        <li><strong>Frequency:</strong> Determined by cavity dimensions (~3 GHz)</li>
                        <li><strong>Clinical use:</strong> Low-energy linacs (4-6 MV), compact & economical</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        class KlystronVisualizer {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.running = false;
                this.time = 0;

                // Component positions
                this.setupDimensions();

                // Electron particles
                this.electrons = [];
                this.bunches = [];

                this.setupCanvas();
                this.draw();
            }

            setupDimensions() {
                const w = this.canvas.width;
                const h = this.canvas.height;

                this.gun = { x: 50, y: h/2, width: 40, height: 80 };
                this.buncher = { x: 150, y: h/2 - 60, width: 50, height: 120 };
                this.catcher = { x: 400, y: h/2 - 60, width: 50, height: 120 };
                this.collector = { x: w - 80, y: h/2 - 40, width: 50, height: 80 };
                this.driftStart = this.buncher.x + this.buncher.width;
                this.driftEnd = this.catcher.x;
                this.beamY = h/2;
            }

            setupCanvas() {
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
                this.setupDimensions();
            }

            toggle() {
                this.running = !this.running;
                if (this.running) this.animate();
            }

            reset() {
                this.running = false;
                this.time = 0;
                this.electrons = [];
                this.bunches = [];
                this.draw();
            }

            animate() {
                if (!this.running) return;

                this.time += 0.02;

                // Generate electrons
                if (Math.random() < 0.3) {
                    this.electrons.push({
                        x: this.gun.x + this.gun.width,
                        y: this.beamY + (Math.random() - 0.5) * 10,
                        vx: 2,
                        bunched: false,
                        bunchPhase: 0
                    });
                }

                // Update electrons
                this.electrons.forEach(e => {
                    // Buncher cavity interaction
                    if (e.x >= this.buncher.x && e.x <= this.buncher.x + this.buncher.width) {
                        // Oscillating E-field modulates velocity
                        const fieldPhase = Math.sin(this.time * 5);
                        e.vx += fieldPhase * 0.05;
                        e.bunchPhase = fieldPhase;
                    }

                    // Drift space - bunching occurs
                    if (e.x > this.driftStart && e.x < this.driftEnd) {
                        e.bunched = true;
                    }

                    e.x += e.vx;
                });

                // Remove off-screen electrons
                this.electrons = this.electrons.filter(e => e.x < this.canvas.width);

                this.draw();
                requestAnimationFrame(() => this.animate());
            }

            draw() {
                const ctx = this.ctx;
                const w = this.canvas.width;
                const h = this.canvas.height;

                // Clear
                ctx.fillStyle = '#2d2d2d';
                ctx.fillRect(0, 0, w, h);

                // Draw structure
                this.drawStructure();

                // Draw RF signals
                this.drawRFSignals();

                // Draw electrons
                this.drawElectrons();
            }

            drawStructure() {
                const ctx = this.ctx;

                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;

                // Electron gun
                ctx.fillStyle = '#1a365d';
                ctx.fillRect(this.gun.x, this.gun.y - this.gun.height/2, this.gun.width, this.gun.height);
                ctx.strokeRect(this.gun.x, this.gun.y - this.gun.height/2, this.gun.width, this.gun.height);

                ctx.fillStyle = '#e0e0e0';
                ctx.font = '11px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Gun', this.gun.x + this.gun.width/2, this.gun.y - this.gun.height/2 - 5);

                // Buncher cavity
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 3;
                ctx.strokeRect(this.buncher.x, this.buncher.y, this.buncher.width, this.buncher.height);
                ctx.fillStyle = '#ef4444';
                ctx.fillText('Buncher', this.buncher.x + this.buncher.width/2, this.buncher.y - 10);
                ctx.fillStyle = '#b0b0b0';
                ctx.font = '9px Arial';
                ctx.fillText('Input RF', this.buncher.x + this.buncher.width/2, this.buncher.y - 20);

                // Drift space
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(this.driftStart, this.beamY - 30);
                ctx.lineTo(this.driftEnd, this.beamY - 30);
                ctx.moveTo(this.driftStart, this.beamY + 30);
                ctx.lineTo(this.driftEnd, this.beamY + 30);
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.fillStyle = '#b0b0b0';
                ctx.font = '10px Arial';
                ctx.fillText('Drift Space (bunching)', (this.driftStart + this.driftEnd)/2, this.beamY - 40);

                // Catcher cavity
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 3;
                ctx.strokeRect(this.catcher.x, this.catcher.y, this.catcher.width, this.catcher.height);
                ctx.fillStyle = '#10b981';
                ctx.font = '11px Arial';
                ctx.fillText('Catcher', this.catcher.x + this.catcher.width/2, this.catcher.y - 10);
                ctx.fillStyle = '#b0b0b0';
                ctx.font = '9px Arial';
                ctx.fillText('Output RF', this.catcher.x + this.catcher.width/2, this.catcher.y - 20);

                // Collector
                ctx.fillStyle = '#1a365d';
                ctx.fillRect(this.collector.x, this.collector.y, this.collector.width, this.collector.height);
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.collector.x, this.collector.y, this.collector.width, this.collector.height);
                ctx.fillStyle = '#e0e0e0';
                ctx.font = '11px Arial';
                ctx.fillText('Collector', this.collector.x + this.collector.width/2, this.collector.y - 5);
            }

            drawRFSignals() {
                const ctx = this.ctx;

                // Input RF (small amplitude)
                const inputX = this.buncher.x - 60;
                const inputY = this.buncher.y + this.buncher.height/2;
                this.drawSineWave(ctx, inputX, inputY, 50, 8, '#10b981', 'Input');

                // Output RF (large amplitude)
                const outputX = this.catcher.x + this.catcher.width + 10;
                const outputY = this.catcher.y + this.catcher.height/2;
                this.drawSineWave(ctx, outputX, outputY, 80, 20, '#10b981', 'Amplified');

                // E-field oscillation in buncher
                if (this.running) {
                    const fieldStrength = Math.sin(this.time * 5);
                    ctx.strokeStyle = `rgba(239, 68, 68, ${Math.abs(fieldStrength) * 0.6})`;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    const cavityCenterX = this.buncher.x + this.buncher.width/2;
                    ctx.moveTo(cavityCenterX, this.buncher.y + 20);
                    ctx.lineTo(cavityCenterX, this.buncher.y + this.buncher.height - 20);
                    ctx.stroke();
                }
            }

            drawSineWave(ctx, startX, startY, width, amplitude, color, label) {
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let x = 0; x <= width; x += 2) {
                    const y = startY + Math.sin((x / width) * Math.PI * 4 + this.time * 5) * amplitude;
                    if (x === 0) ctx.moveTo(startX + x, y);
                    else ctx.lineTo(startX + x, y);
                }
                ctx.stroke();

                if (label) {
                    ctx.fillStyle = color;
                    ctx.font = '9px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(label, startX, startY - amplitude - 5);
                }
            }

            drawElectrons() {
                const ctx = this.ctx;

                this.electrons.forEach(e => {
                    // Draw electron
                    ctx.fillStyle = '#3b82f6';
                    ctx.shadowBlur = 4;
                    ctx.shadowColor = '#3b82f6';
                    ctx.beginPath();
                    ctx.arc(e.x, e.y, e.bunched ? 4 : 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                });
            }
        }

        class MagnetronVisualizer {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.running = false;
                this.time = 0;

                this.setupCanvas();

                // Magnetron geometry
                this.centerX = this.canvas.width / 2;
                this.centerY = this.canvas.height / 2;
                this.cathodeRadius = 40;
                this.anodeRadius = 120;
                this.cavityCount = 8;
                this.cavityRadius = 15;

                // Electrons
                this.electrons = [];

                this.draw();
            }

            setupCanvas() {
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
                this.centerX = this.canvas.width / 2;
                this.centerY = this.canvas.height / 2;
            }

            toggle() {
                this.running = !this.running;
                if (this.running) this.animate();
            }

            reset() {
                this.running = false;
                this.time = 0;
                this.electrons = [];
                this.draw();
            }

            animate() {
                if (!this.running) return;

                this.time += 0.03;

                // Generate electron cloud
                if (this.electrons.length < 40) {
                    const angle = Math.random() * Math.PI * 2;
                    const radius = this.cathodeRadius + Math.random() * (this.anodeRadius - this.cathodeRadius - 20);
                    this.electrons.push({
                        angle: angle,
                        radius: radius,
                        angularVel: 0.05 + Math.random() * 0.02
                    });
                }

                // Update electrons (spiral motion)
                this.electrons.forEach(e => {
                    e.angle += e.angularVel;
                    // Electrons spiral outward slightly
                    e.radius += 0.1;
                });

                // Remove electrons that reach anode
                this.electrons = this.electrons.filter(e => e.radius < this.anodeRadius - 5);

                this.draw();
                requestAnimationFrame(() => this.animate());
            }

            draw() {
                const ctx = this.ctx;
                const w = this.canvas.width;
                const h = this.canvas.height;

                // Clear
                ctx.fillStyle = '#2d2d2d';
                ctx.fillRect(0, 0, w, h);

                // Draw structure
                this.drawStructure();

                // Draw fields
                this.drawFields();

                // Draw electrons
                this.drawElectrons();

                // Draw RF output
                this.drawRFOutput();
            }

            drawStructure() {
                const ctx = this.ctx;

                // Anode (outer circle)
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.arc(this.centerX, this.centerY, this.anodeRadius, 0, Math.PI * 2);
                ctx.stroke();

                // Anode label
                ctx.fillStyle = '#e0e0e0';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Anode', this.centerX, this.centerY - this.anodeRadius - 10);

                // Cavities
                for (let i = 0; i < this.cavityCount; i++) {
                    const angle = (i / this.cavityCount) * Math.PI * 2;
                    const x = this.centerX + Math.cos(angle) * this.anodeRadius;
                    const y = this.centerY + Math.sin(angle) * this.anodeRadius;

                    ctx.fillStyle = '#1a365d';
                    ctx.strokeStyle = '#3b82f6';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(x, y, this.cavityRadius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                }

                // Cathode (center circle)
                ctx.fillStyle = '#1a365d';
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(this.centerX, this.centerY, this.cathodeRadius, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                // Cathode label
                ctx.fillStyle = '#e0e0e0';
                ctx.font = '11px Arial';
                ctx.fillText('Cathode', this.centerX, this.centerY + 5);

                // B-field indicator
                ctx.fillStyle = '#9333ea';
                ctx.font = '14px Arial';
                ctx.fillText('⊙ B', this.centerX, this.centerY - 20);
                ctx.fillStyle = '#b0b0b0';
                ctx.font = '9px Arial';
                ctx.fillText('(into page)', this.centerX, this.centerY - 8);
            }

            drawFields() {
                const ctx = this.ctx;

                // E-field (radial lines)
                ctx.strokeStyle = 'rgba(239, 68, 68, 0.3)';
                ctx.lineWidth = 1;
                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * Math.PI * 2;
                    ctx.beginPath();
                    ctx.moveTo(
                        this.centerX + Math.cos(angle) * this.cathodeRadius,
                        this.centerY + Math.sin(angle) * this.cathodeRadius
                    );
                    ctx.lineTo(
                        this.centerX + Math.cos(angle) * (this.anodeRadius - 20),
                        this.centerY + Math.sin(angle) * (this.anodeRadius - 20)
                    );
                    ctx.stroke();

                    // Arrow heads
                    const arrowX = this.centerX + Math.cos(angle) * (this.anodeRadius - 25);
                    const arrowY = this.centerY + Math.sin(angle) * (this.anodeRadius - 25);
                    ctx.fillStyle = 'rgba(239, 68, 68, 0.3)';
                    ctx.beginPath();
                    ctx.arc(arrowX, arrowY, 2, 0, Math.PI * 2);
                    ctx.fill();
                }

                // E-field label
                ctx.fillStyle = '#ef4444';
                ctx.font = '10px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('E-field', this.centerX + this.anodeRadius - 60, this.centerY - 10);
                ctx.fillText('(radial)', this.centerX + this.anodeRadius - 60, this.centerY + 2);
            }

            drawElectrons() {
                const ctx = this.ctx;

                this.electrons.forEach(e => {
                    const x = this.centerX + Math.cos(e.angle) * e.radius;
                    const y = this.centerY + Math.sin(e.angle) * e.radius;

                    ctx.fillStyle = '#3b82f6';
                    ctx.shadowBlur = 4;
                    ctx.shadowColor = '#3b82f6';
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                });
            }

            drawRFOutput() {
                const ctx = this.ctx;

                // RF output waveguide
                const outputX = this.centerX + this.anodeRadius + 20;
                const outputY = this.centerY;

                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 3;
                ctx.strokeRect(outputX, outputY - 15, 60, 30);

                ctx.fillStyle = '#10b981';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('RF Out', outputX + 30, outputY - 20);

                // RF waveform
                if (this.running) {
                    ctx.strokeStyle = '#10b981';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    for (let x = 0; x < 60; x += 2) {
                        const y = outputY + Math.sin((x / 60) * Math.PI * 6 + this.time * 8) * 10;
                        if (x === 0) ctx.moveTo(outputX + x, y);
                        else ctx.lineTo(outputX + x, y);
                    }
                    ctx.stroke();
                }
            }
        }

        // Initialize visualizers
        let klystronViz, magnetronViz;

        window.addEventListener('DOMContentLoaded', () => {
            klystronViz = new KlystronVisualizer('klystron-canvas');
            magnetronViz = new MagnetronVisualizer('magnetron-canvas');
        });

        window.addEventListener('resize', () => {
            if (klystronViz) {
                klystronViz.setupCanvas();
                klystronViz.draw();
            }
            if (magnetronViz) {
                magnetronViz.setupCanvas();
                magnetronViz.draw();
            }
        });
    </script>
</body>
</html>
